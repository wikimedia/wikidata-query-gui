( function( $, QUnit, sinon, wb ) {
	'use strict';

	QUnit.module( 'wikibase.queryService.ui.resultBrowser' );
	var resultBrowser = wb.queryService.ui.resultBrowser;
	var browsers = [ 'TableResultBrowser', 'ImageResultBrowser', 'CoordinateResultBrowser', 'BubbleChartResultBrowser', 'TreeMapResultBrowser' ];


	var data = {
		EMPTY: {  "head" : {    "vars" : [ ]  },  "results" : {    "bindings" : [ ] }},
		TableResultBrowser: {  "head" : {    "vars" : [ "item", "itemLabel" ]  },  "results" : {    "bindings" : [ {      "item" : {        "type" : "uri",        "value" : "http://www.wikidata.org/entity/Q498787"      },      "itemLabel" : {        "xml:lang" : "en",        "type" : "literal",        "value" : "Muezza"      }    }, {      "item" : {        "type" : "uri",        "value" : "http://www.wikidata.org/entity/Q677525"      },      "itemLabel" : {        "xml:lang" : "en",        "type" : "literal",        "value" : "Orangey"      }    } ] }},
		ImageResultBrowser: {"head":{"vars":["spaceProbeLabel","date","picture"]},"results":{"bindings":[{"date":{"datatype":"http://www.w3.org/2001/XMLSchema#dateTime","type":"literal","value":"1957-10-04T00:00:00Z"},"picture":{"type":"uri","value":"http://commons.wikimedia.org/wiki/Special:FilePath/Sputnik.jpg"},"spaceProbeLabel":{"xml:lang":"fr","type":"literal","value":"Spoutnik1"}},{"date":{"datatype":"http://www.w3.org/2001/XMLSchema#dateTime","type":"literal","value":"1957-10-04T00:00:00Z"},"picture":{"type":"uri","value":"http://commons.wikimedia.org/wiki/Special:FilePath/Sputnik%201.jpg"},"spaceProbeLabel":{"xml:lang":"fr","type":"literal","value":"Spoutnik1"}},{"date":{"datatype":"http://www.w3.org/2001/XMLSchema#dateTime","type":"literal","value":"1961-02-12T00:00:00Z"},"picture":{"type":"uri","value":"http://commons.wikimedia.org/wiki/Special:FilePath/Venera%201%20%28a%29%20%28Memorial%20Museum%20of%20Astronautics%29.JPG"},"spaceProbeLabel":{"xml:lang":"fr","type":"literal","value":"Venera1"}}]}},
		CoordinateResultBrowser: {"head":{"vars":["label","coord","place","image"]},"results":{"bindings":[{"coord":{"datatype":"http://www.opengis.net/ont/geosparql#wktLiteral","type":"literal","value":"Point(41.4869-79.5953)"},"label":{"xml:lang":"en","type":"literal","value":"PitholeStoneArchBridge"}},{"coord":{"datatype":"http://www.opengis.net/ont/geosparql#wktLiteral","type":"literal","value":"Point(43.504611.7996)"},"label":{"xml:lang":"en","type":"literal","value":"PonteBuriano"}}]}},
		BubbleChartResultBrowser: {"head":{"vars":["item","itemLabel","duration"]},"results":{"bindings":[{"item":{"type":"uri","value":"http://www.wikidata.org/entity/Q1440764"},"itemLabel":{"xml:lang":"en","type":"literal","value":"BattleofTimor"},"duration":{"datatype":"http://www.w3.org/2001/XMLSchema#double","type":"literal","value":"356.0"}},{"item":{"type":"uri","value":"http://www.wikidata.org/entity/Q383614"},"itemLabel":{"xml:lang":"en","type":"literal","value":"BattleofKohima"},"duration":{"datatype":"http://www.w3.org/2001/XMLSchema#double","type":"literal","value":"79.0"}}]}},
		TreeMapResultBrowser: {"head":{"vars":["show","showLabel","season","seasonLabel","episode","episodeLabel"]},"results":{"bindings":[{"show":{"type":"uri","value":"http://www.wikidata.org/entity/Q886"},"season":{"type":"uri","value":"http://www.wikidata.org/entity/Q13131"},"episode":{"type":"uri","value":"http://www.wikidata.org/entity/Q48697"},"showLabel":{"xml:lang":"en","type":"literal","value":"TheSimpsons"},"seasonLabel":{"xml:lang":"en","type":"literal","value":"24thseasonofTheSimpsons"},"episodeLabel":{"xml:lang":"en","type":"literal","value":"AdventuresinBaby-Getting"}},{"show":{"type":"uri","value":"http://www.wikidata.org/entity/Q886"},"season":{"type":"uri","value":"http://www.wikidata.org/entity/Q13131"},"episode":{"type":"uri","value":"http://www.wikidata.org/entity/Q218073"},"showLabel":{"xml:lang":"en","type":"literal","value":"TheSimpsons"},"seasonLabel":{"xml:lang":"en","type":"literal","value":"24thseasonofTheSimpsons"},"episodeLabel":{"xml:lang":"en","type":"literal","value":"MoonshineRiver"}}]}},
	};

//	var expected = {
//		TableResultBrowser: '<div class=\"bootstrap-table\"><div class=\"fixed-table-toolbar\"></div><div class=\"fixed-table-container\" style=\"padding-bottom: 0px;\"><div class=\"fixed-table-header\" style=\"display: none;\"><table></table></div><div class=\"fixed-table-body\"><div class=\"fixed-table-loading\" style=\"top: 22px;\">Loading, please wait...</div><table class=\"table table-hover\"><thead><tr><th style=\"\" data-field=\"item\" tabindex=\"0\"><div class=\"th-inner sortable both\">item</div><div class=\"fht-cell\"></div></th><th style=\"\" data-field=\"itemLabel\" tabindex=\"0\"><div class=\"th-inner sortable both\">itemLabel</div><div class=\"fht-cell\"></div></th></tr></thead><tbody><tr data-index=\"0\"><td style=\"\"><a href=\"http://www.wikidata.org/entity/Q498787\" title=\"Explore item\" class=\"explore glyphicon glyphicon-search\" aria-hidden=\"true\"></a> <a href=\"http://www.wikidata.org/entity/Q498787\" target=\"_blank\">wd:Q498787</a></td><td style=\"\">Muezza</td></tr><tr data-index=\"1\"><td style=\"\"><a href=\"http://www.wikidata.org/entity/Q677525\" title=\"Explore item\" class=\"explore glyphicon glyphicon-search\" aria-hidden=\"true\"></a> <a href=\"http://www.wikidata.org/entity/Q677525\" target=\"_blank\">wd:Q677525</a></td><td style=\"\">Orangey</td></tr></tbody></table></div><div class=\"fixed-table-footer\" style=\"display: none;\"><table><tbody><tr></tr></tbody></table></div><div class=\"fixed-table-pagination\" style=\"display: none;\"></div></div></div><div class=\"clearfix\"></div>',
//		ImageResultBrowser: '<div class=\"masonry\"><div class=\"item\"><a data-gallery=\"g\" data-title=\"Sputnik.jpg\" href=\"https://commons.wikimedia.org/wiki/Special:FilePath/Sputnik.jpg?width=1000\"><img src=\"https://commons.wikimedia.org/wiki/Special:FilePath/Sputnik.jpg?width=400\"></a><div><div>spaceProbeLabel: <span>Spoutnik1</span></div><div>picture: <span><a title=\"Show Gallery\" class=\"gallery glyphicon glyphicon-picture\" aria-hidden=\"true\" href=\"https://commons.wikimedia.org/wiki/Special:FilePath/Sputnik.jpg?width=900\" data-gallery=\"G_picture\" data-title=\"Sputnik.jpg\"></a> <a href=\"http://commons.wikimedia.org/wiki/Special:FilePath/Sputnik.jpg\" target=\"_blank\">commons:Sputnik.jpg</a></span></div><div>date: <span>1957-10-04T00:00:00Z</span></div></div></div><div class=\"item\"><a data-gallery=\"g\" data-title=\"Sputnik 1.jpg\" href=\"https://commons.wikimedia.org/wiki/Special:FilePath/Sputnik%201.jpg?width=1000\"><img src=\"https://commons.wikimedia.org/wiki/Special:FilePath/Sputnik%201.jpg?width=400\"></a><div><div>spaceProbeLabel: <span>Spoutnik1</span></div><div>picture: <span><a title=\"Show Gallery\" class=\"gallery glyphicon glyphicon-picture\" aria-hidden=\"true\" href=\"https://commons.wikimedia.org/wiki/Special:FilePath/Sputnik%201.jpg?width=900\" data-gallery=\"G_picture\" data-title=\"Sputnik 1.jpg\"></a> <a href=\"http://commons.wikimedia.org/wiki/Special:FilePath/Sputnik%201.jpg\" target=\"_blank\">commons:Sputnik 1.jpg</a></span></div><div>date: <span>1957-10-04T00:00:00Z</span></div></div></div><div class=\"item\"><a data-gallery=\"g\" data-title=\"Venera 1 (a) (Memorial Museum of Astronautics).JPG\" href=\"https://commons.wikimedia.org/wiki/Special:FilePath/Venera%201%20%28a%29%20%28Memorial%20Museum%20of%20Astronautics%29.JPG?width=1000\"><img src=\"https://commons.wikimedia.org/wiki/Special:FilePath/Venera%201%20%28a%29%20%28Memorial%20Museum%20of%20Astronautics%29.JPG?width=400\"></a><div><div>spaceProbeLabel: <span>Venera1</span></div><div>picture: <span><a title=\"Show Gallery\" class=\"gallery glyphicon glyphicon-picture\" aria-hidden=\"true\" href=\"https://commons.wikimedia.org/wiki/Special:FilePath/Venera%201%20%28a%29%20%28Memorial%20Museum%20of%20Astronautics%29.JPG?width=900\" data-gallery=\"G_picture\" data-title=\"Venera 1 (a) (Memorial Museum of Astronautics).JPG\"></a> <a href=\"http://commons.wikimedia.org/wiki/Special:FilePath/Venera%201%20%28a%29%20%28Memorial%20Museum%20of%20Astronautics%29.JPG\" target=\"_blank\">commons:Venera 1 (a) (Memorial Museum of Astronautics).JPG</a></span></div><div>date: <span>1961-02-12T00:00:00Z</span></div></div></div></div>',
//		CoordinateResultBrowser: '<div id=\"map\" class=\"leaflet-container leaflet-fade-anim\" tabindex=\"0\" style=\"height: 100vh; position: relative;\"><div class=\"leaflet-map-pane\" style=\"transform: translate3d(0px, 0px, 0px);\"><div class=\"leaflet-tile-pane\"><div class=\"leaflet-layer\"><div class=\"leaflet-tile-container\"></div><div class=\"leaflet-tile-container\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131072/131072.png\" style=\"height: 256px; width: 256px; left: 1014px; top: 378px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131071/131071.png\" style=\"height: 256px; width: 256px; left: 758px; top: 122px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131072/131071.png\" style=\"height: 256px; width: 256px; left: 1014px; top: 122px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131071/131072.png\" style=\"height: 256px; width: 256px; left: 758px; top: 378px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131071/131070.png\" style=\"height: 256px; width: 256px; left: 758px; top: -134px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131073/131072.png\" style=\"height: 256px; width: 256px; left: 1270px; top: 378px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131071/131073.png\" style=\"height: 256px; width: 256px; left: 758px; top: 634px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131073/131071.png\" style=\"height: 256px; width: 256px; left: 1270px; top: 122px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131072/131070.png\" style=\"height: 256px; width: 256px; left: 1014px; top: -134px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131072/131073.png\" style=\"height: 256px; width: 256px; left: 1014px; top: 634px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131070/131071.png\" style=\"height: 256px; width: 256px; left: 502px; top: 122px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131070/131072.png\" style=\"height: 256px; width: 256px; left: 502px; top: 378px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131070/131070.png\" style=\"height: 256px; width: 256px; left: 502px; top: -134px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131073/131073.png\" style=\"height: 256px; width: 256px; left: 1270px; top: 634px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131073/131070.png\" style=\"height: 256px; width: 256px; left: 1270px; top: -134px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131070/131073.png\" style=\"height: 256px; width: 256px; left: 502px; top: 634px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131069/131072.png\" style=\"height: 256px; width: 256px; left: 246px; top: 378px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131069/131071.png\" style=\"height: 256px; width: 256px; left: 246px; top: 122px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131074/131072.png\" style=\"height: 256px; width: 256px; left: 1526px; top: 378px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131074/131071.png\" style=\"height: 256px; width: 256px; left: 1526px; top: 122px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131069/131070.png\" style=\"height: 256px; width: 256px; left: 246px; top: -134px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131074/131070.png\" style=\"height: 256px; width: 256px; left: 1526px; top: -134px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131069/131073.png\" style=\"height: 256px; width: 256px; left: 246px; top: 634px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131074/131073.png\" style=\"height: 256px; width: 256px; left: 1526px; top: 634px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131075/131072.png\" style=\"height: 256px; width: 256px; left: 1782px; top: 378px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131075/131071.png\" style=\"height: 256px; width: 256px; left: 1782px; top: 122px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131068/131071.png\" style=\"height: 256px; width: 256px; left: -10px; top: 122px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131068/131072.png\" style=\"height: 256px; width: 256px; left: -10px; top: 378px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131068/131070.png\" style=\"height: 256px; width: 256px; left: -10px; top: -134px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131075/131070.png\" style=\"height: 256px; width: 256px; left: 1782px; top: -134px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131068/131073.png\" style=\"height: 256px; width: 256px; left: -10px; top: 634px;\"><img class=\"leaflet-tile\" src=\"https://maps.wikimedia.org/osm-intl/18/131075/131073.png\" style=\"height: 256px; width: 256px; left: 1782px; top: 634px;\"></div></div></div><div class=\"leaflet-objects-pane\"><div class=\"leaflet-shadow-pane\"><img src=\"http://localhost/gui/vendor/leaflet/images/marker-shadow.png\" class=\"leaflet-marker-shadow leaflet-zoom-animated\" style=\"margin-left: -12px; margin-top: -41px; width: 41px; height: 41px; transform: translate3d(1014px, 378px, 0px);\"></div><div class=\"leaflet-overlay-pane\"></div><div class=\"leaflet-marker-pane\"><img src=\"http://localhost/gui/vendor/leaflet/images/marker-icon.png\" class=\"leaflet-marker-icon leaflet-zoom-animated leaflet-clickable\" tabindex=\"0\" style=\"margin-left: -12px; margin-top: -41px; width: 25px; height: 41px; transform: translate3d(1014px, 378px, 0px); z-index: 378;\"></div><div class=\"leaflet-popup-pane\"></div></div></div><div class=\"leaflet-control-container\"><div class=\"leaflet-top leaflet-left\"><div class=\"leaflet-control-zoom leaflet-bar leaflet-control\"><a class=\"leaflet-control-zoom-in leaflet-disabled\" href=\"#\" title=\"Zoom in\">+</a><a class=\"leaflet-control-zoom-out\" href=\"#\" title=\"Zoom out\">-</a></div><div class=\"leaflet-control-fullscreen leaflet-bar leaflet-control\"><a class=\"leaflet-control-fullscreen-button leaflet-bar-part\" href=\"#\" title=\"View Fullscreen\"></a></div><div class=\"leaflet-zoom-box-control leaflet-bar leaflet-control\" title=\"Zoom to specific area\"><a class=\"glyphicon glyphicon-zoom-in\" href=\"#\"></a></div></div><div class=\"leaflet-top leaflet-right\"><button class=\"undefined btn btn-default leaflet-control\"><span class=\"glyphicon glyphicon-chevron-up\"></span></button></div><div class=\"leaflet-bottom leaflet-left\"></div><div class=\"leaflet-bottom leaflet-right\"><div class=\"leaflet-control-attribution leaflet-control\"><a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a> | Wikimedia maps | Map data Â© <a href=\"http://openstreetmap.org/copyright\">OpenStreetMap contributors</a></div></div></div></div>',
//		BubbleChartResultBrowser: '<div style=\"margin: auto; width: 60%;\"><svg width=\"756\" height=\"756\" class=\"bubble\"><g class=\"node\" transform=\"translate(256.44641178385336,378)\"><title>BattleofTimor: 356</title><circle r=\"256.4464117838533\" style=\"fill: rgb(49, 130, 189);\"></circle><text dy=\".3em\" style=\"text-anchor: middle; cursor: pointer;\">BattleofTimor</text></g><g class=\"node\" transform=\"translate(635.1949266353384,378)\"><title>BattleofKohima: 79</title><circle r=\"120.80507336466145\" style=\"fill: rgb(107, 174, 214);\"></circle><text dy=\".3em\" style=\"text-anchor: middle; cursor: pointer;\">BattleofKohima</text></g></svg></div>',
//		TreeMapResultBrowser: '<svg width=\"2061\" height=\"756\"><g><g class=\"cell parent\"><rect width=\"2061\" height=\"20\" style=\"fill: rgb(85, 85, 85);\"></rect><foreignObject class=\"foreignObject\"><body class=\"labelbody\"><div class=\"label\" style=\"display: block;\"></div></body></foreignObject></g><g class=\"cell parent\"><rect width=\"2061\" height=\"20\" style=\"fill: rgb(85, 85, 85);\"></rect><foreignObject class=\"foreignObject\"><body class=\"labelbody\"><div class=\"label\" style=\"display: block;\"></div></body></foreignObject></g><g class=\"cell parent\"><rect width=\"2061\" height=\"20\" style=\"fill: rgb(85, 85, 85);\"></rect><foreignObject class=\"foreignObject\"><body class=\"labelbody\"><div class=\"label\" style=\"display: block;\"></div></body></foreignObject></g><g class=\"cell child\"><rect class=\"background\" style=\"fill: rgb(31, 119, 180);\"></rect><foreignObject class=\"foreignObject\" width=\"1030.5\" height=\"756\"><body class=\"labelbody\"><div class=\"label\" style=\"display: block;\">AdventuresinBaby-Getting</div></body></foreignObject></g><g class=\"cell child\"><rect class=\"background\" style=\"fill: rgb(31, 119, 180);\"></rect><foreignObject class=\"foreignObject\" width=\"1030.5\" height=\"756\"><body class=\"labelbody\"><div class=\"label\" style=\"display: block;\">MoonshineRiver</div></body></foreignObject></g></g></svg>',
//	};

	$.each( browsers, function( index, browser ){

		QUnit.test( 'When instantiating ' + browser + ' there should be no error ', function( assert ) {
			var b = new resultBrowser[ browser ]();
			b.setResult( {foo:true} );
			assert.ok( true, 'Instantiating must not throw an error' );
		} );


		if( browser !== 'TableResultBrowser' ) {
			QUnit.test( 'When ' + browser + ' is visiting TableResultBrowser with drawable data then drawable must be true', function( assert ) {
				var b = new resultBrowser[ browser ]();
				var tb = new resultBrowser.TableResultBrowser();
				tb.addVisitor( b );
				tb.setResult( data[ browser ] );
				tb.draw( $( '<div> ' ) );

				assert.ok( b.isDrawable(), browser + ' must be drawable' );
			} );

			QUnit.test( 'When ' + browser + ' is visiting TableResultBrowser with not drawable data then drawable must be false', function( assert ) {
				var b = new resultBrowser[ browser ]();
				var tb = new resultBrowser.TableResultBrowser();
				tb.addVisitor( b );
				tb.setResult( data.EMPTY );
				tb.draw( $( '<div> ' ) );

				assert.notOk( b.isDrawable(), browser + ' must be drawable' );
			} );
		}

		QUnit.test( 'When rendering ' + browser + ' then expected result should be displayed ', function( assert ) {
			var b = new resultBrowser[ browser ]();
			b.setResult( data[ browser ] );

			var $result = $( '<div>' ).width( 100 ).height( 100 );
			$result.appendTo( 'body' );

			b.draw( $result );
			assert.ok( true, 'Drawing must not throw an error' );

			//assert.deepEqual( $result.html(), expected[ browser ] , 'Result must be expected result'); //TODO:Not working, because of different resolutions
			$result.remove();
		} );

	} );

}( jQuery, QUnit, sinon, wikibase ) );
